!pip install unidecode
!pip install pytelegrambotapi


import pandas as pd
import string#tratar instrings
import nltk
import numpy as np
from nltk.corpus import stopwords
from nltk.tokenize import word_tokenize
from google.colab import sheets
from unidecode import unidecode
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.metrics.pairwise import cosine_similarity





#leitura da arquivo dentro do github
dataset=pd.read_csv('https://raw.githubusercontent.com/tmelo-uea/cursos/main/dataset.csv',delimiter=';')
dataset.head()

#Linguagem natural Toolkit
nltk.download('stopwords')
nltk.download('punkt')
nltk.download('punkt_tab') # Download the missing resource

#pré-processamento de texto

def remove_pontuacao(text):
  texto_limpo=''
  for palavra in text:
    if palavra not in string.punctuation:
      texto_limpo+=palavra
  return texto_limpo

print(string.punctuation)
def reprocessamento(texto):
  #Remove pontuaçãoes e simbolos
  texto=remove_pontuacao(texto)
  #Remove acentos
  texto=unidecode(texto) # Corrected variable name
  #converte para minúsculo
  texto=texto.lower()
  #tokenização
  tokens=word_tokenize(texto)
  # remover stepwords
  stop_words=stopwords.words('portuguese')
  tokens=[token for token in tokens if token not in stop_words]
  #juntar palavras em uma string
  texto_preprocessado=''.join(tokens)
  return texto_preprocessado
dataset['Pergunta_Preprocessado']=dataset['Pergunta'].apply(reprocessamento)
dataset.head(n=10)
shet=sheets.InteractiveSheet(df=dataset)
#vetorização
vectorizer=TfidfVectorizer()
tfidf_matrix=vectorizer.fit_transform(dataset['Pergunta_Preprocessado'])
#obtendo respostas por uma pergunta
def obter_resposta(pergunta):
  pergunta_preprocessada=reprocessamento(pergunta)# pre processa a pergunta
  pergunta_vetorizada=vectorizer.transform([pergunta_preprocessada])#pergunta->vetor
  similaridades=cosine_similarity(pergunta_vetorizada,tfidf_matrix)#calcula similaridade do cosseno
  pergunta_index=similaridades.argmax()#obtem indice da pergunta
  return dataset["Resposta"].loc[pergunta_index]#devolve aresposta ao usuario

flags=['Fechar','Sair','Tchau']
end=False
while not end:
   question=input()
   if question in flags:
     end=True
   else:
      answer=obter_resposta(question)
      print(answer)
